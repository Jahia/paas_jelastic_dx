---
type: install
version: 0.1
name: Jahia - Digital Experience Manager v7.2.1.1
logo: /images/jahia-logo-70x70.png
id: jahia-dx
description:
  short: Jahia  - Digital Experience Manager v7.2.1.1
  text: Digital Experience Manager gives you an agile customizable platform that manages
    your entire digital ecosystem to innovate and deliver great customer experiences,
    foster internal collaboration and support dynamic business needs for sustainable
    growth.
baseUrl: https://github.com/Jahia/paas_jelastic_dx/raw/7.2.1.1

globals:
  dx_version: 7.2.1.1
  url_package: ${baseUrl}
  url_universal_package: https://github.com/Jahia/paas_jelastic_dx_universal/raw/1.0

settings:
  fields: 
  - name: rootpwd
    type: string
    caption: Jahia DX root password
    vtype: text
    required: true
  - name: toolspwd
    type: string
    caption: Jahia tools password
    vtype: text
    required: true
  - name: browsingCount
    type: string
    caption: Number of DX browsing nodes
    vtype: text
    required: true
    default: 2
  - name: envRegion
    type: regionlist
    caption: Region 
    vtype: list
    required: true    
  - name: mode
    type: radio-fieldset
    caption: Operating Mode
    values:
      production: production
      development: development
    default: production
    showIf:
      production:
        - name: ddogApikey
          type: string
          caption: Datadog API KEY
          required: true
          vtype: text


  - caption: DB stack
    type: list
    name: stack
    default: mariadb-dockerized
    required: true
    values:        
      - value: mysql
        caption: MySQL CE
      - value: mariadb-dockerized
        caption: MariaDB
    
  - caption: DB topology
    type: list
    name: dbscheme
    required: true      
    dependsOn:                 
      stack:
          mysql:
            - value: slave
              caption: Master-Slave with extra slaves
            - value: master
              caption: Master-Master with extra slaves
            - value: single
              caption: Single Group Replication
            - value: multi
              caption: Multi Group Replication              

          mariadb-dockerized:    
            - value: lonely
              caption: One, lonely, sad and single master
            - value: slave
              caption: Master-Slave with extra slaves
            - value: master
              caption: Master-Master with extra slaves
            - value: galera
              caption: Galera Cluster

  - type: checkbox
    name: is_proxysql
    caption: Add ProxySQL for SQL Load Balancing
    value: false

  - caption: None
    inputType: hidden
    type: list
    name: dbnodeType
    dependsOn:                 
      stack:
          mysql:
            - value: mysql
          mariadb-dockerized:    
            - value: mariadb-dockerized

  - caption: None
    inputType: hidden
    type: list
    name: dbnodes
    dependsOn:                 
      dbscheme:
          lonely:
            - value: 1
          slave:
            - value: 2
          master:    
            - value: 2
          single:
            - value: 3
          multi:    
            - value: 3
          galera:    
            - value: 3



  - name: shortdomain
    type: envname
    caption: Environment
    required: true 
  - name: displayname
    type: string 
    caption: Display Name 
    default: Jahia - Digital Experience Manager v7.2.1.1
    required: true

onInstall:
  - install: 
      jps: ${globals.url_universal_package}/dx-cluster-universal.yml
      shortdomain: ${settings.shortdomain}
      region: ${settings.envRegion}
      settings:
        shortdomain: ${settings.shortdomain}
        dxVersion: ${globals.dx_version}
        rootpwd: ${settings.rootpwd}
        toolspwd: ${settings.toolspwd}
        browsingCount: ${settings.browsingCount}
        mode: ${settings.mode}
        ddogApikey: ${settings.ddogApikey}
        dbnodeType: ${settings.dbnodeType}
        dbscheme: ${settings.dbscheme}
        dbnodes: ${settings.dbnodes}
        stack: ${settings.stack}
        is_proxysql: ${settings.is_proxysql}



